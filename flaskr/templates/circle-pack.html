<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="static/js/raceChart.js"></script>
    <title>Narrative Viz for CS416</title>
</head>
<body>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <div><center><h2>Two Decades of Industry Consolidation</h2></center></div>
    <svg preserveAspectRatio="xMidYMid meet"></svg>

<!-- style section-->
<style></style>

<!-- Code adapted from @Mike Bostock's Race Chart: 
    https://observablehq.com/@d3/bar-chart-race-explained-->
<script>

var width = 460
var height = 460
var diameter = 600;

let data = d3.json("static/data/flights88.json") 

// function setColor(data){
//         const scale = d3.scaleOrdinal(d3.schemeTableau10);
//         if (data.some(d => d.category !== undefined)) {
//             const categoryByName = new Map(data.map(d => [d.Code, d.category]))
//             scale.domain(categoryByName.values());
//             return d => scale(categoryByName.get(d.Code));
//         }
//         return d => scale(d.Code);
// }


data.then(function(data){
    console.log(data)
    chart(data)
})

async function chart(data){
    console.log("Inside chart function...")
    console.log(data)


    var color = d3.scaleOrdinal(d3.schemeTableau10);

    var svg = d3.select("body")
                .append("svg")
                .attr("width", diameter)
                .attr("height", diameter)
                .attr("class", "bubble");

    var bubble = d3.pack(data)
            .size([diameter, diameter])
            .padding(1.5);

    var nodes = d3.hierarchy(data)
            .sum(function(d) { return d.count; });

    var node = svg.selectAll(".node")
            .data(bubble(nodes).descendants())
            .enter()
            .filter(function(d){
                return  !d.children
            })
            .append("g")
            .attr("class", "node")
            .attr("transform", function(d) {
                return "translate(" + d.x + "," + d.y + ")";
            });
                
    node.append("title")
                .text(function(d) {
                    return d.Code;
                });
    
    node.append("circle")
            .attr("r", function(d) {
                return d.r;
            })
            .style("fill", function(d,i) {
                return color(i);
            });
    

    node.append("text")
                .attr("dy", ".2em")
                .style("text-anchor", "middle")
                .text(function(d) {
                    return d.data.Code;
                })
                .attr("font-family", "sans-serif")
                .attr("font-size", function(d){
                    return d.r/5;
                })
                .attr("fill", "white");

    d3.select(self.frameElement)
                .style("height", diameter + "px");
}
    
</script>
</body>
</html>
