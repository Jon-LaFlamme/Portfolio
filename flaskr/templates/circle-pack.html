<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="static/js/raceChart.js"></script>
    <title>Narrative Viz for CS416</title>
</head>
<body>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <div><center><h2>Two Decades of Industry Consolidation</h2></center></div>
    <svg preserveAspectRatio="xMidYMid meet"></svg>

<!-- style section-->
<style></style>

<!-- Code adapted from @Mike Bostock's Race Chart: 
    https://observablehq.com/@d3/bar-chart-race-explained-->
<script type="text/javascript">
    

    //************ Data *******************
    let data = d3.json("static/data/flights88.json")
    // schema: data.count, data.Code, data.Name


    const margin = {top: 16, right: 100, bottom: 6, left: 50}
    const width = 900 - margin.left - margin.right
    const height = 500

    var formatNumber = d3.format(",d")
    const svg = d3.select("svg")
        .attr("viewBox", [0, 0, width, height]);
    
    const carrierColor = d3.scaleOrdinal(d3.schemePaired) 
    var diameter = 600;

  

    data.then(function(data) {

        console.log(data)
        chart()     //Automatically Plays when browser loads
    })

    function pack(data) {
            return d3.pack(data)  
            .size([width - 2, height - 2])
            .padding(3)
    }
    
    function chart() {
        const root = pack(data)

        var bubble = d3.pack(data)
            .size([diameter, diameter])
            .padding(1.5);
        
        const svg = d3.select("body")
            .append('svg')
            .attr("width", diameter)
            .attr("height", diameter)
            .attr("class", "bubble");
        
        var nodes = d3.hierarchy(data)
            .sum(function(d) { return d.count; });
        
        var node = svg.selectAll(".node")
            .data(bubble(nodes).descendants())
            .enter()
            .filter(function(d){
                return  !d.children
            })
            .append("g")
            .attr("class", "node")
            .attr("transform", function(d) {
                return "translate(" + d.x + "," + d.y + ")";
            });

        node.append("title")
            .text(function(d) {
                return d.Code;
            });

        node.append("circle")
            .attr("r", function(d) {
                return 5 //d.r; Need to dynamically configure radius length
            })
            .style("fill", function(d,i) {
                return carrierColor(i);
            });

        d3.select(self.frameElement)
            .style("height", diameter + "px");
            
        return svg.node();
    }
    


 

</script>
</body>
</html>
